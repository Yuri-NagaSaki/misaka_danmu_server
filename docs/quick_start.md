# å¾¡å‚å¼¹å¹•æœåŠ¡å™¨ - ä¸€é”®éƒ¨ç½²æŒ‡å—

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### ä¸€é”®éƒ¨ç½²å‘½ä»¤
```bash
# ä¸‹è½½éƒ¨ç½²è„šæœ¬
curl -fsSL https://raw.githubusercontent.com/your-repo/misaka_danmu_server/main/scripts/deploy.sh -o deploy.sh

# ç»™äºˆæ‰§è¡Œæƒé™
chmod +x deploy.sh

# è¿è¡Œéƒ¨ç½²
./deploy.sh
```

### éƒ¨ç½²æµç¨‹

éƒ¨ç½²è„šæœ¬å°†å¼•å¯¼æ‚¨å®Œæˆä»¥ä¸‹æ­¥éª¤ï¼š

1. **ç³»ç»Ÿæ£€æŸ¥** - è‡ªåŠ¨æ£€æµ‹Dockerå’ŒDocker Compose
2. **æ•°æ®åº“é€‰æ‹©** - é€‰æ‹©MySQLæˆ–PostgreSQL
3. **å¯†ç ç”Ÿæˆ** - è‡ªåŠ¨ç”Ÿæˆå®‰å…¨çš„éšæœºå¯†ç 
4. **ç¯å¢ƒé…ç½®** - è‡ªåŠ¨åˆ›å»ºæ‰€æœ‰å¿…éœ€çš„é…ç½®æ–‡ä»¶
5. **æœåŠ¡å¯åŠ¨** - è‡ªåŠ¨æ„å»ºé•œåƒå¹¶å¯åŠ¨æœåŠ¡

### éƒ¨ç½²è¾“å‡ºç¤ºä¾‹

```
==================================================
ğŸ¬ Misaka å¼¹å¹•æœåŠ¡å™¨ - ä¸€é”®éƒ¨ç½²è„šæœ¬
==================================================
æ£€æŸ¥ç³»ç»Ÿä¾èµ–...
âœ… ç³»ç»Ÿä¾èµ–æ£€æŸ¥é€šè¿‡

è¯·é€‰æ‹©æ•°æ®åº“ç±»å‹:
1) MySQL 8.1 (æ¨èæ–°æ‰‹)
2) PostgreSQL 15 (æ¨èé«˜çº§ç”¨æˆ·)
è¯·è¾“å…¥é€‰æ‹© (1-2): 2
âœ… å·²é€‰æ‹© PostgreSQL æ•°æ®åº“

é…ç½®æ•°æ®åº“å¯†ç :
âœ… æ•°æ®åº“ç”¨æˆ·å¯†ç : NoRfXaxBesF7X8z1

âš ï¸  è¯·è®°å½•ä»¥ä¸Šå¯†ç ï¼Œç”¨äºåç»­æ•°æ®åº“ç®¡ç†ï¼
æŒ‰ Enter ç»§ç»­...

--------------------------------------------------
ğŸ‰ éƒ¨ç½²æˆåŠŸå®Œæˆï¼
--------------------------------------------------

ğŸ“‹ æœåŠ¡ä¿¡æ¯:
  ğŸŒ Webç®¡ç†ç•Œé¢: http://localhost:7768
  ğŸ“– APIæ¥å£æ–‡æ¡£: http://localhost:7768/docs
  ğŸ¥ æœåŠ¡å¥åº·æ£€æŸ¥: http://localhost:7768/health
  ğŸ“Š æ•°æ®åº“ç±»å‹: postgresql
  ğŸ“ é¡¹ç›®ç›®å½•: /home/user/misaka_danmu_server

ğŸ‘¤ ç™»å½•ä¿¡æ¯:
  ç”¨æˆ·å: admin
  å¯†ç : Abc123DefGhi

ğŸ” æ•°æ®åº“ä¿¡æ¯:
  æ•°æ®åº“ç”¨æˆ·: danmaku_user
  æ•°æ®åº“å¯†ç : NoRfXaxBesF7X8z1
  æ•°æ®åº“åç§°: danmaku_db
```

## ğŸ› ï¸ æœåŠ¡ç®¡ç†

### ç®¡ç†å‘½ä»¤

```bash
# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/manage.sh status

# å¯åŠ¨æœåŠ¡
./scripts/manage.sh start

# åœæ­¢æœåŠ¡
./scripts/manage.sh stop

# é‡å¯æœåŠ¡
./scripts/manage.sh restart

# æŸ¥çœ‹å®æ—¶æ—¥å¿—
./scripts/manage.sh logs
```

### å®Œæ•´å¸è½½

```bash
# å¸è½½æœåŠ¡ï¼ˆä»…åˆ é™¤å®¹å™¨å’Œé•œåƒï¼Œä¿ç•™é…ç½®ï¼‰
./scripts/deploy.sh --uninstall
```

## ğŸ“ è‡ªåŠ¨ç›®å½•ç»“æ„

éƒ¨ç½²è„šæœ¬ä¼šåœ¨ç”¨æˆ·å®¶ç›®å½•ä¸‹åˆ›å»ºä»¥ä¸‹ç»“æ„ï¼š

```
~/misaka_danmu_server/
â”œâ”€â”€ .env                    # ç¯å¢ƒå˜é‡é…ç½®
â”œâ”€â”€ docker-compose.*.yml    # Dockerç¼–æ’æ–‡ä»¶
â”œâ”€â”€ Dockerfile             # é•œåƒæ„å»ºæ–‡ä»¶
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config.yml         # åº”ç”¨é…ç½®æ–‡ä»¶
â”œâ”€â”€ docker/
â”‚   â”œâ”€â”€ mysql/
â”‚   â”‚   â””â”€â”€ init.sql       # MySQLåˆå§‹åŒ–è„šæœ¬
â”‚   â””â”€â”€ postgres/
â”‚       â””â”€â”€ init.sql       # PostgreSQLåˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ logs/                  # åº”ç”¨æ—¥å¿—ç›®å½•
â””â”€â”€ data/                  # æ•°æ®å­˜å‚¨ç›®å½•
```

## ğŸ”’ å®‰å…¨ç‰¹æ€§

- **è‡ªåŠ¨å¯†ç ç”Ÿæˆ**: ä½¿ç”¨OpenSSLç”Ÿæˆå¼ºéšæœºå¯†ç 
- **érootè¿è¡Œ**: å®¹å™¨ä½¿ç”¨éç‰¹æƒç”¨æˆ·è¿è¡Œ
- **é…ç½®éš”ç¦»**: æ•æ„Ÿé…ç½®å­˜å‚¨åœ¨ç‹¬ç«‹çš„ç¯å¢ƒæ–‡ä»¶ä¸­
- **å®¹å™¨éš”ç¦»**: æœåŠ¡è¿è¡Œåœ¨ç‹¬ç«‹çš„Dockerç½‘ç»œä¸­

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹ç«¯å£

ç¼–è¾‘ `~/misaka_danmu_server/.env` æ–‡ä»¶ï¼š
```bash
SERVER_PORT=8080  # ä¿®æ”¹ä¸ºæ‚¨æƒ³è¦çš„ç«¯å£
```

é‡å¯æœåŠ¡ï¼š
```bash
cd ~/misaka_danmu_server
docker-compose -f docker-compose.*.yml restart
```

### ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 

ç¼–è¾‘ `~/misaka_danmu_server/.env` æ–‡ä»¶ï¼š
```bash
ADMIN_PASSWORD=your_new_password
```

é‡å¯æœåŠ¡ä½¿é…ç½®ç”Ÿæ•ˆã€‚

## ğŸ“Š ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux / macOS / Windows with WSL2
- **Docker**: 20.10+ 
- **Docker Compose**: 2.0+
- **å†…å­˜**: æœ€å°‘512MBå¯ç”¨å†…å­˜
- **ç£ç›˜**: æœ€å°‘2GBå¯ç”¨ç©ºé—´

## ğŸ†˜ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **ç«¯å£è¢«å ç”¨**
   ```bash
   # æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
   sudo lsof -i :7768
   
   # æˆ–ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ SERVER_PORT
   ```

2. **Dockeræƒé™é—®é¢˜**
   ```bash
   # å°†ç”¨æˆ·åŠ å…¥dockerç»„
   sudo usermod -aG docker $USER
   
   # é‡æ–°ç™»å½•ä½¿æƒé™ç”Ÿæ•ˆ
   ```

3. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
   ./scripts/manage.sh logs
   
   # æ£€æŸ¥å®¹å™¨çŠ¶æ€
   docker ps -a
   ```

### è·å–å¸®åŠ©

- æŸ¥çœ‹éƒ¨ç½²è„šæœ¬å¸®åŠ©: `./scripts/deploy.sh --help`
- æŸ¥çœ‹ç®¡ç†è„šæœ¬å¸®åŠ©: `./scripts/manage.sh --help`
- æŸ¥çœ‹å®¹å™¨æ—¥å¿—: `./scripts/manage.sh logs`